"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,a){for(var e=0;e<a.length;e++){var i=a[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(a,e,i){return e&&t(a.prototype,e),i&&t(a,i),a}}(),JsonApiDataStoreModel=function(){function t(a,e){_classCallCheck(this,t),this.id=e,this._type=a,this._attributes=[],this._relationships=[]}return _createClass(t,[{key:"serialize",value:function(t){var a=this,e={data:{type:this._type}};return t=t||{},t.attributes=t.attributes||this._attributes,t.relationships=t.relationships||this._relationships,void 0!==this.id&&(e.data.id=this.id),0!==t.attributes.length&&(e.data.attributes={}),0!==t.relationships.length&&(e.data.relationships={}),t.attributes.forEach(function(t){e.data.attributes[t]=a[t]}),t.relationships.forEach(function(t){function i(t){return{type:t._type,id:t.id}}a[t]?a[t].constructor===Array?e.data.relationships[t]={data:a[t].map(i)}:e.data.relationships[t]={data:i(a[t])}:e.data.relationships[t]={data:null}}),e}},{key:"setAttribute",value:function(t,a){void 0===this[t]&&this._attributes.push(t),this[t]=a}},{key:"setRelationship",value:function(t,a){void 0===this[t]&&this._relationships.push(t),this[t]=a}}]),t}(),JsonApiDataStore=function(){function t(){_classCallCheck(this,t),this.graph={}}return _createClass(t,[{key:"destroy",value:function(t){delete this.graph[t._type][t.id]}},{key:"find",value:function(t,a){return this.graph[t]&&this.graph[t][a]?this.graph[t][a]:null}},{key:"findAll",value:function(t){var a=this;return this.graph[t]?Object.keys(a.graph[t]).map(function(e){return a.graph[t][e]}):[]}},{key:"reset",value:function(){this.graph={}}},{key:"initModel",value:function(t,a){return this.graph[t]=this.graph[t]||{},this.graph[t][a]=this.graph[t][a]||new JsonApiDataStoreModel(t,a),this.graph[t][a]}},{key:"syncRecord",value:function(t){function a(t){if(!i.find(t.type,t.id)){var a=i.initModel(t.type,t.id);a._placeHolder=!0}return i.graph[t.type][t.id]}var e,i=this,n=this.initModel(t.type,t.id);delete n._placeHolder;for(e in t.attributes)n._attributes.push(e),n[e]=t.attributes[e];if(t.relationships)for(e in t.relationships){var r=t.relationships[e];if("[object Array]"===Object.prototype.toString.call(r)){for(var s={data:[]},o=0;o<r.length;o++)s.data.push(r[o].data);r=s}void 0!==r.data&&(n._relationships.push(e),null===r.data?n[e]=null:r.data.constructor===Array?n[e]=r.data.map(a):n[e]=a(r.data)),r.links&&console.log("Warning: Links not implemented yet.")}return n}},{key:"syncWithMeta",value:function(t){var a=t.data,e=this.syncRecord.bind(this);return a?(t.included&&t.included.map(e),{data:a.constructor===Array?a.map(e):e(a),meta:"meta"in t?t.meta:null}):[]}},{key:"sync",value:function(t){return this.syncWithMeta(t).data}}]),t}();"undefined"!=typeof module&&(module.exports={JsonApiDataStore:JsonApiDataStore,JsonApiDataStoreModel:JsonApiDataStoreModel});