angular.module("beauby.jsonApiDataStore",[]).factory("JsonApiDataStore",function(){function t(t,i){this.id=i,this._type=t,this._attributes=[],this._relationships=[]}function i(){this.graph={}}return t.prototype.serialize=function(t){var i,r=this;return t||(t={}),t.attributes||(t.attributes=this._attributes),t.relationships||(t.relationships=this._relationships),i={data:{type:this._type,id:this.id}},0!==t.attributes.length&&(i.data.attributes={}),0!==t.relationships.length&&(i.data.relationships={}),t.attributes.forEach(function(t){i.data.attributes[t]=r[t]}),t.relationships.forEach(function(t){function a(t){return{type:t._type,id:t.id}}i.data.relationships[t]=r[t].constructor===Array?{data:r[t].map(a)}:{data:a(r[t])}}),i},i.prototype.reset=function(){this.graph={}},i.prototype.find=function(t,i){return this.graph[t]&&this.graph[t][i]?this.graph[t][i]:null},i.prototype.destroy=function(t){delete this.graph[t._type][t.id]},i.prototype.initModel=function(i,r){return this.graph[i]||(this.graph[i]={}),this.graph[i][r]||(this.graph[i][r]=new t(i,r)),this.graph[i][r]},i.prototype.syncRecord=function(t){function i(t){if(!a.find(t.type,t.id)){var i=a.initModel(t.type,t.id);i._placeHolder=!0}return a.graph[t.type][t.id]}var r,a=this,n=this.initModel(t.type,t.id);delete n._placeHolder;for(r in t.attributes)n._attributes.push(r),n[r]=t.attributes[r];if(t.relationships)for(r in t.relationships){var e=t.relationships[r];void 0!==e.data&&(n._relationships.push(r),n[r]=null===e.data?null:e.data.constructor===Array?e.data.map(i):i(e.data)),e.links&&console.log("Warning: Links not implemented yet.")}return n},i.prototype.sync=function(t){function i(t){return t?t.constructor===Array?t.map(r.syncRecord.bind(r)):r.syncRecord(t):null}var r=this;return i(t.included),i(t.data)},new i});